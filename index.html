<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Runner 0212 con Parallax y Ancho Real</title>
<style>
  body {
    margin: 0;
    background: black;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
  }
  canvas {
    background: #1a1a1a;
  }
</style>
</head>
<body>

<canvas id="game" width="800" height="400"></canvas>

<script>
// ====== ASSETS ======
const runImg = new Image(); runImg.src = './character/run.png';
const jumpImg = new Image(); jumpImg.src = './character/jump.png';

// Capas de ciudad
const bgBack = new Image(); bgBack.src = './environment/background.PNG';
const bgMid1 = new Image(); bgMid1.src = './environment/midground1.PNG';
const bgMid2 = new Image(); bgMid2.src = './environment/midground2.PNG';
const fgFront = new Image(); fgFront.src = './environment/foreground.PNG';

// ====== CONSTANTES ======
const FRAMES = 6;
const JUMP_FRAMES = 8;
const JUMP_SPEED = 5;

// ====== PLAYER ======
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const player = {
  x: 80,
  y: 0,
  vy: 0,
  gravity: 1.2,
  jumpForce: -18,
  ground: canvas.height - 60,
  drawW: 200,      // personaje más grande
  jumping: false
};

// ====== INPUT ======
function jump() {
  if (!player.jumping) {
    player.vy = player.jumpForce;
    player.jumping = true;
  }
}

window.addEventListener("keydown", e => { if(e.code === 'Space') jump(); });
canvas.addEventListener("click", jump);

// ====== ANIMACIÓN ======
let frame = 0, timer = 0, jumpFrame = 0, jumpTimer = 0;

// ====== CAPAS DE FONDO (con ancho real) ======
let bgX=0, mid1X=0, mid2X=0, fgX=0;
const bgBackWidth = bgBack.width;
const bgMid1Width = bgMid1.width;
const bgMid2Width = bgMid2.width;
const fgFrontWidth = fgFront.width;

function drawLayer(img, x, speed) {
  const scale = canvas.height / img.height;       // escalar según altura
  const width = img.width * scale;               // ancho proporcional

  ctx.drawImage(img, x, 0, width, canvas.height);
  ctx.drawImage(img, x + width, 0, width, canvas.height);

  x -= speed;
  if (x <= -width) x = 0;
  return x;
}


// ====== LOOP PRINCIPAL ======
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // DIBUJAR CAPAS DE FONDO
  bgX = drawLayer(bgBack, bgX, 1, bgBackWidth);
  mid1X = drawLayer(bgMid1, mid1X, 3, bgMid1Width);

  // FÍSICA DEL JUGADOR
  player.vy += player.gravity;
  player.y += player.vy;
  if (player.y >= player.ground) {
    player.y = player.ground;
    player.vy = 0;
    player.jumping = false;
  }

  // ANIMACIÓN DEL JUGADOR
  let img, frameW, currentFrame;
  if (player.jumping) {
    img = jumpImg;
    frameW = img.width / JUMP_FRAMES;
    jumpTimer++;
    if (jumpTimer > JUMP_SPEED) { jumpFrame = (jumpFrame + 1) % JUMP_FRAMES; jumpTimer = 0; }
    currentFrame = jumpFrame;
  } else {
    img = runImg;
    frameW = img.width / FRAMES;
    timer++;
    if (timer > 5) { frame = (frame + 1) % FRAMES; timer = 0; }
    currentFrame = frame;
    jumpFrame = 0;
  }

  const scale = player.drawW / frameW;
  const drawHScaled = img.height * scale;
  const drawY = player.y - drawHScaled;

  // DIBUJAR AL PERSONAJE ENTRE mid1 y mid2
  ctx.drawImage(img, currentFrame * frameW, 0, frameW, img.height, player.x, drawY, player.drawW, drawHScaled);

  // Capas más cercanas
  mid2X = drawLayer(bgMid2, mid2X, 2, bgMid2Width);
  fgX = drawLayer(fgFront, fgX, 3, fgFrontWidth);

  // TODO: dibujar obstáculos aquí

  requestAnimationFrame(loop);
}

// START
runImg.onload = () => { player.y = player.ground; loop(); };
</script>

</body>
</html>
