<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Bebito Club - Runner Game</title>
<style>
  body {
    margin: 0;
    background: black;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
  }
  canvas {
    background: #1a1a1a;
  }
</style>
</head>
<body>

<canvas id="game" width="800" height="400"></canvas>

<script>
// ====== CANVAS ======
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ====== IMÁGENES ======
const runImg = new Image(); runImg.src = './character/run.png';
const jumpImg = new Image(); jumpImg.src = './character/jump.png';

const bgBack = new Image(); bgBack.src = './environment/background.PNG';
const mid1A = new Image(); mid1A.src = './environment/midground1A.PNG';
const mid1B = new Image(); mid1B.src = './environment/midground1B.PNG';
const bgMid2 = new Image(); bgMid2.src = './environment/midground2.PNG';
const fgFront = new Image(); fgFront.src = './environment/foreground.PNG';

// ====== CONSTANTES ======
const FRAMES = 6;
const JUMP_FRAMES = 8;
const JUMP_SPEED = 5;

// ====== PLAYER ======
const player = {
  x: 80,
  y: 0,
  vy: 0,
  gravity: 1.2,
  jumpForce: -18,
  ground: canvas.height - 50,
  drawW: 220,
  jumping: false
};

// ====== INPUT ======
function jump() {
  if (!player.jumping) {
    player.vy = player.jumpForce;
    player.jumping = true;
  }
}
window.addEventListener("keydown", e => { if (e.code === 'Space') jump(); });
canvas.addEventListener("click", jump);

// ====== ANIMACIÓN ======
let frame = 0, timer = 0, jumpFrame = 0, jumpTimer = 0;

// ====== POSICIONES ======
let bgX = 0;
let mid1AX = 0;
let mid1BX = 0;
let mid2X = 0;
let fgX = 0;

const mid2Gap = 400;

// ====== DIMENSIONES ESCALADAS ======
let bgWidth, mid1Width, mid2Width, fgWidth;

// ====== LOOP ======
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Background
  ctx.drawImage(bgBack, bgX, 0, bgWidth, canvas.height);
  ctx.drawImage(bgBack, bgX + bgWidth, 0, bgWidth, canvas.height);
  bgX -= 1;
  if (bgX <= -bgWidth) bgX = 0;

  // Midground 1 A + B
  ctx.drawImage(mid1A, mid1AX, 0, mid1Width, canvas.height);
  ctx.drawImage(mid1B, mid1BX, 0, mid1Width, canvas.height);

  mid1AX -= 2.7;
  mid1BX -= 2.7;
  if (mid1AX <= -mid1Width) mid1AX = mid1BX + mid1Width;
  if (mid1BX <= -mid1Width) mid1BX = mid1AX + mid1Width;

  // Player physics
  player.vy += player.gravity;
  player.y += player.vy;
  if (player.y >= player.ground) {
    player.y = player.ground;
    player.vy = 0;
    player.jumping = false;
  }

  // Player animation
  let img, frameW, currentFrame;
  if (player.jumping) {
    img = jumpImg;
    frameW = img.width / JUMP_FRAMES;
    jumpTimer++;
    if (jumpTimer > JUMP_SPEED) {
      jumpFrame = (jumpFrame + 1) % JUMP_FRAMES;
      jumpTimer = 0;
    }
    currentFrame = jumpFrame;
  } else {
    img = runImg;
    frameW = img.width / FRAMES;
    timer++;
    if (timer > 5) {
      frame = (frame + 1) % FRAMES;
      timer = 0;
    }
    currentFrame = frame;
    jumpFrame = 0;
  }

  const scale = player.drawW / frameW;
  const drawH = img.height * scale;
  const drawY = player.y - drawH;

  ctx.drawImage(
    img,
    currentFrame * frameW, 0,
    frameW, img.height,
    player.x, drawY,
    player.drawW, drawH
  );

  // Midground 2 con gap
  ctx.drawImage(bgMid2, mid2X, 0, mid2Width, canvas.height);
  mid2X -= 2.7;
  if (mid2X <= -mid2Width - mid2Gap) {
    mid2X = canvas.width + mid2Gap;
  }

  // Foreground
  ctx.drawImage(fgFront, fgX, 0, fgWidth, canvas.height);
  ctx.drawImage(fgFront, fgX + fgWidth, 0, fgWidth, canvas.height);
  fgX -= 4;
  if (fgX <= -fgWidth) fgX = 0;

  requestAnimationFrame(loop);
}

// ====== CARGA ======
const images = [runImg, jumpImg, bgBack, mid1A, mid1B, bgMid2, fgFront];
let loaded = 0;

images.forEach(img => {
  img.onload = () => {
    loaded++;
    if (loaded === images.length) startGame();
  };
});

function startGame() {
  // Escalar una sola vez
  bgWidth = bgBack.width * (canvas.height / bgBack.height);
  mid1Width = mid1A.width * (canvas.height / mid1A.height);
  mid2Width = bgMid2.width * (canvas.height / bgMid2.height);
  fgWidth = fgFront.width * (canvas.height / fgFront.height);

  player.y = player.ground;
  mid1AX = 0;
  mid1BX = mid1Width;
  mid2X = canvas.width;

  loop();
}
</script>

</body>
</html>


