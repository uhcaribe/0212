<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title> 0212:PM </title>
  <style>
    body {
      margin: 0;
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    canvas {
      background: #1a1a1a;
    }
  </style>
</head>
<body>

<canvas id="game" width="800" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ========= ASSETS ========= */
const runImg = new Image();
runImg.src = "./character/run.png";

const jumpImg = new Image();
jumpImg.src = "./character/jump.png";

/* ========= CONSTANTES ========= */
const FRAMES = 6;
const JUMP_FRAMES = 8;
const JUMP_SPEED = 5;

const RUN_DRAW_H = 96;
const JUMP_DRAW_H = 120; // AJUSTA SI QUIERES

let frame = 0;
let timer = 0;
let jumpFrame = 0;
let jumpTimer = 0;

/* ========= PLAYER ========= */
const player = {
  x: 80,
  y: 0,
  vy: 0,
  gravity: 1.2,
  jumpForce: -18,
  ground: canvas.height - 50,
  drawW: 220,
  jumping: false
};

/* ========= INPUT ========= */
function jump() {
  if (!player.jumping) {
    player.vy = player.jumpForce;
    player.jumping = true;
  }
}

window.addEventListener("keydown", e => {
  if (e.code === "Space") jump();
});

canvas.addEventListener("click", jump);

/* ========= LOOP ========= */
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  /* física */
  player.vy += player.gravity;
  player.y += player.vy;

  if (player.y >= player.ground) {
    player.y = player.ground;
    player.vy = 0;
    player.jumping = false;
  }

  /* animación */
  let img, frameW, currentFrame;

  if (player.jumping) {
    img = jumpImg;
    frameW = img.width / JUMP_FRAMES;

    jumpTimer++;
    if (jumpTimer > JUMP_SPEED) {
      jumpFrame = (jumpFrame + 1) % JUMP_FRAMES;
      jumpTimer = 0;
    }

    currentFrame = jumpFrame;
  } else {
    img = runImg;
    frameW = img.width / FRAMES;

    timer++;
    if (timer > 4) {
      frame = (frame + 1) % FRAMES;
      timer = 0;
    }

    currentFrame = frame;
    jumpFrame = 0;
  }

  /* escala proporcional para que no se aplaste */
  const scale = player.drawW / frameW;
  const drawHScaled = img.height * scale;
  const drawY = player.y - drawHScaled;

  ctx.drawImage(
    img,
    currentFrame * frameW,
    0,
    frameW,
    img.height,
    player.x,
    drawY,
    player.drawW,
    drawHScaled
  );

  requestAnimationFrame(loop);
}

/* ========= START ========= */
runImg.onload = () => {
  player.y = player.ground;
  loop();
};
</script>

</body>
</html>
